/**
 * Share.js 0.2.0
 * https://github.com/ArtemFitiskin/share
 *
 * (c) 2015
 */

!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Share=b()}(this,function(){"use strict";function a(a){var b={};return a&&"[object Function]"===b.toString.call(a)}function b(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function c(a,b){var c,d=[{value:1e18,symbol:"E"},{value:1e15,symbol:"P"},{value:1e12,symbol:"T"},{value:1e9,symbol:"G"},{value:1e6,symbol:"M"},{value:1e3,symbol:"K"}];for(c=0;c<d.length;c++)if(a>=d[c].value)return(a/d[c].value).toFixed(b).replace(/\.0+$|(\.[0-9]*[1-9])0+$/,"$1")+d[c].symbol;return a.toString()}function d(a,c){for(var d in c)b(c,d)&&(a[d]=c[d]);return b(c,"toString")&&(a.toString=c.toString),b(c,"valueOf")&&(a.valueOf=c.valueOf),a}function e(a,b){this.config=a,this.callback=b,this.results={},this.reached=0,this.requested=0,this.timeout=!1,this.socialIframes={},this.createSocialIframes(),this.createScopeIframe()}function f(b,c){var f={include:g,exclude:[],url:window.location.href,useFormatter:!1,delay:5e3},h=function(){};a(b)?h=c:("object"==typeof b&&d(f,b),a(c)&&(h=c));new e(f,h)}var g=["vk","fb","ok","tw"];return e.map={vk:"//vkontakte.ru/share.php?act=count&index=1&format=json&url=",ok:"//ok.ru/dk?st.cmd=extLike&uid=odklcnt0&ref=",fb:"//api.facebook.com/restserver.php?callback=getFB&method=links.getStats&format=json&urls=",tw:"//urls.api.twitter.com/1/urls/count.json?callback=getTW&url="},e.prototype.formatCount=function(a){return a=Number(a),a&&this.config.useFormatter?c(a,1):a},e.prototype.createSocialIframes=function(){for(var a=escape(this.config.url),b=window.location.protocol,c=0,d=this.config.include.length;d>c;c++){var f=this.config.include[c];-1===this.config.exclude.indexOf(f)&&-1!==g.indexOf(f)&&(this.socialIframes[f]=this.createSocialIframe(b+e.map[f]+a,f),this.requested++)}},e.prototype.createScopeIframe=function(){var a=this,b=function(){a.timeout=setTimeout(function(){a.callback(a.results),a.scopeIframe.parentNode.removeChild(a.scopeIframe)},a.config.delay),this.contentWindow.window.getTW=function(){a.push("tw",arguments)},this.contentWindow.window.getFB=function(){a.push("fb",arguments)},this.contentWindow.window.VK={Share:{count:function(){a.push("vk",arguments)}}},this.contentWindow.window.ODKL={updateCount:function(){a.push("ok",arguments)}},a.socialIframes.vk&&this.contentWindow.document.body.appendChild(a.socialIframes.vk),a.socialIframes.ok&&this.contentWindow.document.body.appendChild(a.socialIframes.ok),a.socialIframes.tw&&this.contentWindow.document.body.appendChild(a.socialIframes.tw),a.socialIframes.fb&&this.contentWindow.document.body.appendChild(a.socialIframes.fb)};this.scopeIframe=document.createElement("iframe"),this.scopeIframe.setAttribute("id","scopeIframe"),this.scopeIframe.style.width="1px",this.scopeIframe.style.height="1px",this.scopeIframe.style.display="none",this.scopeIframe.onload=b,document.body.appendChild(this.scopeIframe)},e.prototype.push=function(a,b){var c;switch(a){case"ok":case"vk":void 0!==b[1]&&(c=b[1]);break;case"tw":"object"==typeof b[0]&&b[0].hasOwnProperty("count")&&(c=b[0].count);break;case"fb":b=b[0],"object"==typeof b[0]&&b[0].hasOwnProperty("share_count")&&(c=b[0].share_count)}void 0!==c&&(this.results[a]=this.formatCount(c),this.reached++),this.reached>=this.requested&&(clearTimeout(this.timeout),this.callback(this.results),this.scopeIframe.parentNode.removeChild(this.scopeIframe))},e.prototype.createSocialIframe=function(a,b){var c=document.createElement("script"),d=this;return c.src=a,c.async=!0,c.onerror=function(a){d.results[b]=!1,d.reached++,d.reached>=d.requested&&(clearTimeout(d.timeout),d.callback(d.results),d.scopeIframe.parentNode.removeChild(d.scopeIframe))},c},f});