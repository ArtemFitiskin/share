/**
 * Share.js 0.1.2
 * https://github.com/ArtemFitiskin/share
 *
 * (c) 2015
 */

!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Share=b()}(this,function(){"use strict";function a(a){var b={};return a&&"[object Function]"===b.toString.call(a)}function b(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function c(a,c){for(var d in c)b(c,d)&&(a[d]=c[d]);return b(c,"toString")&&(a.toString=c.toString),b(c,"valueOf")&&(a.valueOf=c.valueOf),a}function d(a,b){this.config=a,this.callback=b,this.results={},this.reached=0,this.requested=0,this.timeout=!1,this.socialIframes={},this.createSocialIframes(),this.createScopeIframe()}function e(b,e){var g={include:f,exclude:[],url:window.location.href,delay:5e3},h=function(){};a(b)?h=e:("object"==typeof b&&c(g,b),a(e)&&(h=e));new d(g,h)}var f=["vk","fb","ok","tw"];return d.map={vk:"//vkontakte.ru/share.php?act=count&index=1&format=json&url=",ok:"//ok.ru/dk?st.cmd=extLike&uid=odklcnt0&ref=",fb:"//api.facebook.com/restserver.php?callback=getFB&method=links.getStats&format=json&urls=",tw:"//urls.api.twitter.com/1/urls/count.json?callback=getTW&url="},d.prototype.createSocialIframes=function(){for(var a=escape(this.config.url),b=window.location.protocol,c=0,e=this.config.include.length;e>c;c++){var g=this.config.include[c];-1===this.config.exclude.indexOf(g)&&-1!==f.indexOf(g)&&(this.socialIframes[g]=this.createSocialIframe(b+d.map[g]+a,g),this.requested++)}},d.prototype.createScopeIframe=function(){var a=this,b=function(){a.timeout=setTimeout(function(){a.callback(a.results),a.scopeIframe.parentNode.removeChild(a.scopeIframe)},a.config.delay),this.contentWindow.window.getTW=function(){a.push("tw",arguments)},this.contentWindow.window.getFB=function(){a.push("fb",arguments)},this.contentWindow.window.VK={Share:{count:function(){a.push("vk",arguments)}}},this.contentWindow.window.ODKL={updateCount:function(){a.push("ok",arguments)}},a.socialIframes.vk&&this.contentWindow.document.body.appendChild(a.socialIframes.vk),a.socialIframes.ok&&this.contentWindow.document.body.appendChild(a.socialIframes.ok),a.socialIframes.tw&&this.contentWindow.document.body.appendChild(a.socialIframes.tw),a.socialIframes.fb&&this.contentWindow.document.body.appendChild(a.socialIframes.fb)};this.scopeIframe=document.createElement("iframe"),this.scopeIframe.setAttribute("id","scopeIframe"),this.scopeIframe.style.width="1px",this.scopeIframe.style.height="1px",this.scopeIframe.style.display="none",this.scopeIframe.onload=b,document.body.appendChild(this.scopeIframe)},d.prototype.push=function(a,b){var c;switch(a){case"ok":case"vk":void 0!==b[1]&&(c=b[1]);break;case"tw":"object"==typeof b[0]&&b[0].hasOwnProperty("count")&&(c=b[0].count);break;case"fb":b=b[0],"object"==typeof b[0]&&b[0].hasOwnProperty("share_count")&&(c=b[0].share_count)}void 0!==c&&(this.results[a]=Number(c),this.reached++),this.reached>=this.requested&&(clearTimeout(this.timeout),this.callback(this.results),this.scopeIframe.parentNode.removeChild(this.scopeIframe))},d.prototype.createSocialIframe=function(a,b){var c=document.createElement("script"),d=this;return c.src=a,c.async=!0,c.onerror=function(a){d.results[b]=!1,d.reached++,d.reached>=d.requested&&(clearTimeout(d.timeout),d.callback(d.results),d.scopeIframe.parentNode.removeChild(d.scopeIframe))},c},e});